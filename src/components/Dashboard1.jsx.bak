import React from 'react';
import {
  Box,
  Typography,
  FormControlLabel,
  Switch,
  Card,
  CardContent,
  Grid,
  Slider
} from '@mui/material';
import { useSystem } from '../context/SystemContext';
import { motion } from 'framer-motion';
import { styled } from '@mui/material/styles';
import '../styles/dashboard.css';
import { CustomSlider } from './ui/CustomSlider';

const StyledCard = styled(Card)(({ theme }) => ({
  background: 'rgba(255, 255, 255, 0.03)',
  backdropFilter: 'blur(16px)',
  border: '1px solid rgba(255, 255, 255, 0.1)',
  borderRadius: theme.shape.borderRadius * 2,
  transition: 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)',
  '&:hover': {
    transform: 'translateY(-2px)',
    boxShadow: '0 20px 25px -5px rgba(0, 0, 0, 0.1)',
  },
}));

const StyledSlider = styled(Slider)(({ color }) => ({
  color: color || '#3b82f6',
  height: 4,
  '& .MuiSlider-thumb': {
    width: 16,
    height: 16,
    transition: '0.3s cubic-bezier(.47,1.64,.41,.8)',
    '&:hover': {
      boxShadow: '0 0 0 8px rgba(59, 130, 246, 0.16)',
    },
  },
}));

export default function Dashboard1() {
  const {
    metals, setMetals,
    glass, setGlass,
    fabrics, setFabrics,
    plastics, setPlastics,
    plastics3D, setPlastics3D,
    intervalDays, setIntervalDays,
    override, setOverride,
    customInterval, setCustomInterval,
    pyroFeed,
    energy,
    yields,
    arcThermal
  } = useSystem();

  const totalOutput = (value) => value * intervalDays * customInterval;

  return (
    <motion.div 
      initial={{ opacity: 0 }}
      animate={{ opacity: 1 }}
      className="dashboard"
    >
      <Typography 
        variant="h4" 
        component={motion.h1}
        initial={{ y: -20, opacity: 0 }}
        animate={{ y: 0, opacity: 1 }}
        transition={{ duration: 0.5 }}
        sx={{ 
          textAlign: 'center',
          mb: 4,
          color: 'primary.light',
          fontWeight: 700,
          letterSpacing: '-0.025em'
        }}
      >
        üóëÔ∏è Waste Processing System
      </Typography>

      <Grid container spacing={3}>
        <Grid item xs={12} md={6}>
          <motion.div
            initial={{ y: 20, opacity: 0 }}
            animate={{ y: 0, opacity: 1 }}
            transition={{ duration: 0.5, delay: 0.2 }}
          >
            <StyledCard>
              <CardContent>
                <Typography variant="h6" sx={{ mb: 3, color: 'primary.light' }}>
                  Material Inputs
                </Typography>
                
                <Box sx={{ '& > :not(:last-child)': { mb: 3 } }}>
                  <Box>
                    <Box sx={{ display: 'flex', justifyContent: 'space-between', mb: 1 }}>
                      <Typography color="text.secondary">Metals</Typography>
                      <Typography color="primary.light" fontWeight="600">
                        {metals.toFixed(2)} kg/day
                      </Typography>
                    </Box>
                    <StyledSlider
                      value={metals}
                      min={0}
                      max={5}
                      step={0.1}
                      onChange={(e, v) => setMetals(v)}
                      sx={{ color: '#ff6b35' }}
                    />
                  </Box>

                  <Box>
                    <Box sx={{ display: 'flex', justifyContent: 'space-between', mb: 1 }}>
                      <Typography color="text.secondary">Glass</Typography>
                      <Typography color="primary.light" fontWeight="600">
                        {glass.toFixed(2)} kg/day
                      </Typography>
                    </Box>
                    <Slider
                      value={glass}
                      min={0}
                      max={5}
                      step={0.1}
                      onChange={(e, v) => setGlass(v)}
                      sx={{ color: '#00ff88' }}
                    />
                  </Box>

                  <Box>
                    <Box sx={{ display: 'flex', justifyContent: 'space-between', mb: 1 }}>
                      <Typography color="text.secondary">Fabrics/Foams</Typography>
                      <Typography color="primary.light" fontWeight="600">
                        {fabrics.toFixed(2)} kg/day
                      </Typography>
                    </Box>
                    <Slider
                      value={fabrics}
                      min={0}
                      max={8}
                      step={0.1}
                      onChange={(e, v) => setFabrics(v)}
                      sx={{ color: '#ff1493' }}
                    />
                  </Box>

                  <Box>
                    <Box sx={{ display: 'flex', justifyContent: 'space-between', mb: 1 }}>
                      <Typography color="text.secondary">Plastics</Typography>
                      <Typography color="primary.light" fontWeight="600">
                        {plastics.toFixed(2)} kg/day
                      </Typography>
                    </Box>
                    <Slider
                      value={plastics}
                      min={0}
                      max={8}
                      step={0.1}
                      onChange={(e, v) => setPlastics(v)}
                      sx={{ color: '#ffa500' }}
                    />
                  </Box>

                  <Box>
                    <Box sx={{ display: 'flex', justifyContent: 'space-between', mb: 1 }}>
                      <Typography color="text.secondary">3D Plastics</Typography>
                      <Typography color="primary.light" fontWeight="600">
                        {plastics3D.toFixed(2)} kg/day
                      </Typography>
                    </Box>
                    <Slider
                      value={plastics3D}
                      min={0}
                      max={5}
                      step={0.1}
                      onChange={(e, v) => setPlastics3D(v)}
                      sx={{ color: '#9932cc' }}
                    />
                  </Box>

                  <FormControlLabel
                    control={
                      <Switch
                        checked={override}
                        onChange={(e) => setOverride(e.target.checked)}
                        sx={{ '& .MuiSwitch-switchBase.Mui-checked': { color: '#ff6b35' } }}
                      />
                    }
                    label="Override: Divert 3D plastics to pyro"
                    sx={{ color: '#fff' }}
                  />

                  <Box>
                    <Box sx={{ display: 'flex', justifyContent: 'space-between', mb: 1 }}>
                      <Typography color="text.secondary">Recycling Interval</Typography>
                      <Typography color="primary.light" fontWeight="600">
                        {intervalDays} days
                      </Typography>
                    </Box>
                    <Slider
                      value={intervalDays}
                      min={1}
                      max={90}
                      step={1}
                      onChange={(e, v) => setIntervalDays(v)}
                      sx={{ color: '#00bfff' }}
                    />
                  </Box>

                  <Box>
                    <Box sx={{ display: 'flex', justifyContent: 'space-between', mb: 1 }}>
                      <Typography color="text.secondary">Custom Output Interval</Typography>
                      <Typography color="primary.light" fontWeight="600">
                        {customInterval} sols
                      </Typography>
                    </Box>
                    <Slider
                      value={customInterval}
                      min={1}
                      max={1000}
                      step={1}
                      onChange={(e, v) => setCustomInterval(v)}
                      sx={{ color: '#9932cc' }}
                    />
                    <Typography variant="caption" sx={{ color: '#ccc', display: 'block', mt: 1 }}>
                      Range: 1-1000 sols (1 sol ‚âà 24.6 hours)
                    </Typography>
                  </Box>
                </Box>
              </CardContent>
            </StyledCard>
          </motion.div>
        </Grid>

        <Grid item xs={12} md={6}>
          <Card sx={{ height: '100%', display: 'flex', flexDirection: 'column', borderRadius: 2, position: 'relative', overflow: 'hidden', border: '1px solid rgba(255,255,255,0.04)', background: 'linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.02))' }}>
            <Box sx={{ position: 'absolute', right: 16, top: 16, width: 36, height: 36, display: 'flex', alignItems: 'center', justifyContent: 'center', borderRadius: 1, background: 'rgba(255,255,255,0.02)' }}>
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2v6M6 6l6 6 6-6" stroke="#fff" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" opacity="0.7"/>
              </svg>
            </Box>
            
            <CardContent sx={{ flex: 1 }}>
              <Typography variant="h6" sx={{ mb: 2, color: '#00ffff' }}>Process Calculations</Typography>

              <motion.div 
                initial={{ opacity: 0, y: 20 }} 
                animate={{ opacity: 1, y: 0 }} 
                transition={{ duration: 0.5 }}
              >
                <Box sx={{ display: 'flex', gap: 3, alignItems: 'flex-start' }}>
                  <Box sx={{ flex: 1 }}>
                    <Typography sx={{ color: '#ff6b35', fontSize: 14, fontWeight: 700 }}>
                      Pyrolysis Feed
                    </Typography>
                    <Typography variant="h4" sx={{ color: '#fff', mb: 1 }}>
                      {pyroFeed.toFixed(2)} kg/day
                    </Typography>
                    <Typography variant="caption" sx={{ color: '#9fb3c8', display: 'block', mb: 2 }}>
                      ({plastics.toFixed(1)} √ó 0.6 + {fabrics.toFixed(1)} + {override ? '100%' : '50%'} of 3D plastics)
                    </Typography>

                    <Box sx={{ mt: 1 }}>
                      <Typography sx={{ color: '#00ffff', fontWeight: 700, mb: 1 }}>
                        Energy Generation
                      </Typography>
                      <Box sx={{ display: 'flex', flexDirection: 'column', gap: 1 }}>
                        <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', p: 1, borderRadius: 1, background: 'rgba(0,255,136,0.04)' }}>
                          <Typography sx={{ color: '#00ff88' }}>SOFC</Typography>
                          <Typography sx={{ color: '#fff', fontWeight: 700 }}>
                            {energy.electricKWh.toFixed(2)} kWh/day
                          </Typography>
                        </Box>
                        <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', p: 1, borderRadius: 1, background: 'rgba(255,107,53,0.04)' }}>
                          <Typography sx={{ color: '#ff6b35' }}>Thermal (Syngas)</Typography>
                          <Typography sx={{ color: '#fff', fontWeight: 700 }}>
                            {energy.thermalKWh.toFixed(2)} kWh/day
                          </Typography>
                        </Box>
                        <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', p: 1, borderRadius: 1, background: 'rgba(255,165,0,0.03)' }}>
                          <Typography sx={{ color: '#ffa500' }}>Thermal (Arc)</Typography>
                          <Typography sx={{ color: '#fff', fontWeight: 700 }}>
                            {arcThermal.toFixed(2)} kWh/day
                          </Typography>
                        </Box>
                      </Box>
                    </Box>
                  </Box>

                  <Box sx={{ width: 320 }}>
                    <Typography sx={{ color: '#00ffff', fontWeight: 700, mb: 1 }}>
                      Material Yields
                    </Typography>
                    <Box sx={{ display: 'flex', flexDirection: 'column', gap: 1, mb: 2 }}>
                      <Box sx={{ display: 'flex', justifyContent: 'space-between', p: 1, borderRadius: 1, background: 'rgba(153,50,204,0.04)' }}>
                        <Typography sx={{ color: '#9932cc' }}>Oil</Typography>
                        <Typography sx={{ color: '#fff', fontWeight: 700 }}>
                          {yields.oilL.toFixed(2)} L/day
                        </Typography>
                      </Box>
                      <Box sx={{ display: 'flex', justifyContent: 'space-between', p: 1, borderRadius: 1, background: 'rgba(255,20,147,0.04)' }}>
                        <Typography sx={{ color: '#ff1493' }}>Char</Typography>
                        <Typography sx={{ color: '#fff', fontWeight: 700 }}>
                          {yields.charKg.toFixed(2)} kg/day
                        </Typography>
                      </Box>
                    </Box>

                    <Typography sx={{ color: '#9fb3c8', mb: 1 }}>
                      Total Output ({customInterval} sols)
                    </Typography>
                    <Box sx={{ display: 'flex', flexDirection: 'column', gap: 1 }}>
                      <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', p: 1.25, borderRadius: 2, background: 'linear-gradient(90deg, rgba(0,191,255,0.06), rgba(0,255,136,0.03))' }}>
                        <Typography sx={{ color: '#00bfff' }}>Total Oil</Typography>
                        <Typography sx={{ color: '#fff', fontWeight: 800 }}>
                          {totalOutput(yields.oilL).toFixed(0)} L
                        </Typography>
                      </Box>
                      <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', p: 1.25, borderRadius: 2, background: 'linear-gradient(90deg, rgba(0,255,136,0.04), rgba(153,50,204,0.02))' }}>
                        <Typography sx={{ color: '#00ff88' }}>Total Char</Typography>
                        <Typography sx={{ color: '#fff', fontWeight: 800 }}>
                          {totalOutput(yields.charKg).toFixed(0)} kg
                        </Typography>
                      </Box>
                      <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', p: 1.25, borderRadius: 2, background: 'linear-gradient(90deg, rgba(255,107,53,0.05), rgba(153,50,204,0.02))' }}>
                        <Typography sx={{ color: '#ff6b35' }}>Total Energy</Typography>
                        <Typography sx={{ color: '#fff', fontWeight: 800 }}>
                          {totalOutput(energy.electricKWh + arcThermal).toFixed(0)} kWh
                        </Typography>
                      </Box>
                    </Box>
                  </Box>
                </Box>
              </motion.div>
            </CardContent>
          </Card>
        </Grid>
      </Grid>
    </motion.div>
  );
}