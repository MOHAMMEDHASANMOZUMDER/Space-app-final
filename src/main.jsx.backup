import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import CssBaseline from '@mui/material/CssBaseline'
import './index.css'
import App from './App.jsx'
import Flowchart from '../public/Flowchart.jsx'
import Dashboard2Page from './components/Dashboard2Page.jsx'
import Flowchart2Page from './components/Flowchart2Page.jsx'

// Wait for DOM to be ready
document.addEventListener('DOMContentLoaded', function() {
  // Mount the main dashboard to root-dashboard div
  const dashboardContainer = document.getElementById('root-dashboard');
  if (dashboardContainer) {
    const dashboardRoot = createRoot(dashboardContainer);
    dashboardRoot.render(
      <StrictMode>
        <CssBaseline />
        <App />
      </StrictMode>
    );
  }

  // Mount the flowchart to root-flowchart div
  const flowchartContainer = document.getElementById('root-flowchart');
  if (flowchartContainer) {
    const flowchartRoot = createRoot(flowchartContainer);
    flowchartRoot.render(
      <div style={{ 
        width: '100%', 
        height: '100%', 
        background: 'linear-gradient(135deg, #0a0f1a, #1a1f2e)',
        fontFamily: 'Inter, system-ui, Arial, sans-serif',
        borderRadius: '16px'
      }}>
        <Flowchart />
      </div>
    );
  }

  // Keep the original root mounting for backward compatibility
  const rootContainer = document.getElementById('root');
  if (rootContainer && !dashboardContainer && !flowchartContainer) {
    // Only mount to root if we're not in the integrated page
    const hash = window.location.hash || '';
    const isFlowchartRoute = window.location.pathname === '/flowchart' || window.location.pathname.includes('flowchart') || hash === '#flowchart' || window.location.search.includes('flowchart');
    const isDashboard2Route = hash === '#dashboard2' || window.location.pathname.includes('dashboard2');
    const isFlowchart2Route = hash === '#flowchart2' || window.location.pathname.includes('flowchart2');

    console.log('Route detection:', {
      pathname: window.location.pathname,
      hash,
      search: window.location.search,
      isFlowchartRoute,
      isDashboard2Route,
      isFlowchart2Route
    });

    let AppToRender = (
      <StrictMode>
        <CssBaseline />
        <App />
      </StrictMode>
    );

    if (isDashboard2Route) {
      AppToRender = (
        <div style={{ width: '100vw', height: '100vh', background: 'linear-gradient(135deg, #0a0f1a, #1a1f2e)', fontFamily: 'Inter, system-ui, Arial, sans-serif', margin: 0, padding: 0, overflow: 'hidden' }}>
          <Dashboard2Page />
        </div>
      );
    } else if (isFlowchart2Route) {
      AppToRender = (
        <div style={{ width: '100vw', height: '100vh', background: 'linear-gradient(135deg, #0a0f1a, #1a1f2e)', fontFamily: 'Inter, system-ui, Arial, sans-serif', margin: 0, padding: 0, overflow: 'hidden' }}>
          <Flowchart2Page />
        </div>
      );
    } else if (isFlowchartRoute) {
      AppToRender = (
        <div style={{ width: '100vw', height: '100vh', background: 'linear-gradient(135deg, #0a0f1a, #1a1f2e)', fontFamily: 'Inter, system-ui, Arial, sans-serif', margin: 0, padding: 0, overflow: 'hidden' }}>
          <Flowchart />
        </div>
      );
    }

    createRoot(rootContainer).render(AppToRender);
  }
});
